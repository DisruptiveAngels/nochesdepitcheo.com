"use strict";$(function(){function t(t,n){var e='\n      <div class="product" id="product-'+t.id+'">\n        <div class="product-title">'+t.title+'</div>\n\n        <figure class="product-image">\n          <img src="'+t.selectedVariantImage.src+'" alt="'+t.title+'">\n          <button data-product-id="'+t.id+'"\n            class="btn btn--buy js-prevent-cart-listener">\n            COMPRAR\n          </button>\n        </figure>\n\n        <div class="product-info">\n          <div class="product-variantSelector"></div>\n          <span class="product-price">'+t.selectedVariant.formattedPrice+"</span>\n        </div>\n      </div>\n    ";$("#product-list").append(e)}function n(t){return t.options.map(function(t){var n=t.values.map(function(t){return'<option value="'+t+'">'+t+"</option>"});return'\n        <select class="select" name="'+t.name+'">'+n+"</select>\n      "})}function e(t){$("#product-"+t.id+" .product-variantSelector").html(n(t))}function i(){var t=this;$(".cart .btn--close").on("click",p),$(document).on("click",function(t){$(t.target).closest(".cart").length||$(t.target).closest(".js-prevent-cart-listener").length||p()});$(document).on("keydown",function(t){27===t.which&&(T&&($(T).focus(),T=""),p())}),$('[data-js="btn-cart-checkout"]').on("click",function(){window.open(q.checkoutUrl,"_self")}),$(".btn--buy").on("click",a),$(".cart").on("click",".quantity-increment",function(){m($(this).data("product-id"),$(this).data("variant-id"))}),$(".cart").on("click",".quantity-decrement",function(){v($(this).data("product-id"),$(this).data("variant-id"))}),$(".cart").on("keyup",".cart-item__quantity",k(u,250)),$(".btn--cart-tab").click(function(){j(t),f()})}function a(t){t.preventDefault();var n=$(this).data("product-id"),e=x[n],i=e.selectedVariant.id,a=h(i),r=a?a.quantity+1:1;g(e.selectedVariant,r),j(t.target),$("#checkout").focus()}function r(t){var n="#product-"+t.id;$(n+" .product-variantSelector").on("change","select",function(n){var e=$(n.target),i=e.attr("name"),a=e.val();t.options.filter(function(t){return t.name===i})[0].selected=a,c(t),o(t)})}function c(t){var n=t.selectedVariantImage,e=n?n.src:ShopifyBuy.NO_IMAGE_URI;$("#product-"+t.id+" .product-image").attr("src",e)}function o(t){var n=t.selectedVariant;$("#product-"+t.id+" .product-price").text("$"+n.price)}function d(t,n,e){var i=x[n],a=i.variants.filter(function(t){return t.id===e})[0],r=h(a.id);if(r){s(r,t(r.quantity))}}function u(t){var n=parseInt($(this).closest(".cart-item").data("product-id"),10),e=parseInt($(this).closest(".cart-item").data("variant-id"),10),i=x[n],a=i.variants.filter(function(t){return t.id===e})[0],r=h(a.id),c=t.target.value;r&&s(r,c)}function s(t,n){var e=t.variant_id,i=q.lineItems.length;q.updateLineItem(t.id,n).then(function(n){var a=$(".cart").find('.cart-item[data-variant-id="'+e+'"]');n.lineItems.length>=i?(a.find(".cart-item__quantity").val(t.quantity),a.find(".cart-item__price").text(b(t.line_price))):a.addClass("js-hidden").bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){a.remove()}),C(),l(),n.lineItems.length<1&&p()}).catch(function(t){console.log("failed"),console.error(t)})}function l(){$(".cart .pricing").text(b(q.subtotal))}function f(){$(".cart").addClass("js-active")}function p(){$(".cart").removeClass("js-active"),$(".overlay").removeClass("js-active")}function v(t,n){d(function(t){return t-1},t,n)}function m(t,n){d(function(t){return t+1},t,n)}function h(t){return q.lineItems.filter(function(n){return n.variant_id===t})[0]}function g(t,n){f();var e=h(t.id);e?s(e,n):_(t,n),C()}function _(t,n){f(),q.createLineItemsFromVariants({variant:t,quantity:n}).then(function(){var n=q.lineItems.filter(function(n){return n.variant_id===t.id})[0],e=y(n),i=$(".cart-item-container");i.append(e),setTimeout(function(){i.find(".js-hidden").removeClass("js-hidden")},0)}).catch(function(t){console.log("failed"),console.error(t)}),l(),C()}function y(t){var n=$("#CartItemTemplate").html(),e=$(n),i=t.image.src,a=t.variant_id,r=t.product_id;return e.attr("data-product-id",r),e.attr("data-variant-id",a),e.addClass("js-hidden"),e.find(".cart-item__img").css("background-image","url("+i+")"),e.find(".cart-item__title").text(t.title),e.find(".cart-item__variant-title").text(t.variant_title),e.find(".cart-item__price").text(b(t.line_price)),e.find(".cart-item__quantity").attr("value",t.quantity),e.find(".quantity-decrement").attr({"data-variant-id":a,"data-product-id":r}),e.find(".quantity-increment").attr({"data-variant-id":a,"data-product-id":r}),e}function I(){var t=$(".cart-item-container");t.empty();var n=q.lineItems.map(function(t,n){return y(t)});t.append(n),setTimeout(function(){t.find(".js-hidden").removeClass("js-hidden")},0),l()}function b(t,n,e,i,a){n=n||"$",e=e||",",i=i||".",a=a||".";var r=new RegExp("(\\d)(?=(\\d{3})+\\.)","g");return n+parseFloat(t,10).toFixed(2).replace(a,i).replace(r,"$1"+e).toString()}function C(){q.lineItems.length>0?($(".btn--cart-tab .btn__counter").html(q.lineItemCount),$(".btn--cart-tab").addClass("js-active")):($(".btn--cart-tab").removeClass("js-active"),$(".cart").removeClass("js-active"))}function j(t){T=t}function k(t,n,e){var i=void 0;return function(){var a=this,r=arguments,c=function(){i=null,e||t.apply(a,r)},o=e&&!i;clearTimeout(i),i=setTimeout(c,n),o&&t.apply(a,r)}}var q,S,T,x,V=ShopifyBuy.buildClient({accessToken:"70713926e14ee6c0b19f901fe0e30efa",domain:"noches-de-pitcheo.myshopify.com",appId:"6"});localStorage.getItem("lastCartId")?V.fetchCart(localStorage.getItem("lastCartId")).then(function(t){q=t,S=q.lineItems.length,I()}):V.createCart().then(function(t){q=t,localStorage.setItem("lastCartId",q.id),S=0}),V.fetchQueryProducts({collection_id:"379094994"}).then(function(n){return x=n.reduce(function(t,n){return t[n.id]=n,t},{}),n.forEach(function(n,i){t(n,i),e(n),r(n)})}).then(function(){C(),i()}).catch(function(t){console.log("failed request"),console.error(t)})});